# 评估与分析

<cite>
**本文档引用的文件**
- [performance_evaluator.py](file://evaluation/performance_evaluator.py)
- [evaluation.py](file://experiments/evaluation.py)
- [visualize_results.py](file://visualize_results.py)
- [advanced_visualization.py](file://tools/advanced_visualization.py)
- [algorithm_diagnostics_20250919_162514.json](file://results/algorithm_diagnostics_20250919_162514.json)
- [algorithm_diagnostics_20250919_202955.json](file://results/algorithm_diagnostics_20250919_202955.json)
- [full_experiment_results.json](file://results/full_experiment_results.json)
</cite>

## 目录
1. [性能评估框架](#性能评估框架)
2. [实验分析流程](#实验分析流程)
3. [结果文件结构](#结果文件结构)
4. [可视化分析工具](#可视化分析工具)
5. [分析案例](#分析案例)
6. [结论](#结论)

## 性能评估框架

`performance_evaluator.py` 模块实现了系统性能评估的核心框架，通过 `PerformanceEvaluator` 类对多智能体算法的性能进行量化评估。该类首先从仿真结果中提取基本性能指标，包括任务完成率、平均时延、总能耗和缓存命中率。在此基础上，计算衍生指标：能量效率（完成任务数/总能耗）和时延效率（1/平均时延），以衡量资源利用的有效性。

评估的核心是综合性能分数的计算。该分数通过加权求和的方式整合多个关键指标。权重分配为：完成率（30%）、时延效率（25%）、能量效率（20%）和缓存命中率（25%）。在计算前，各指标会进行归一化处理，例如将时延效率限制在0-10范围内，能量效率除以1000后限制在0-1范围内，确保不同量纲的指标可以公平比较。最终的综合分数用于对不同算法进行排名，确定最优算法，并计算其相对于其他算法的改进幅度。

**Section sources**
- [performance_evaluator.py](file://evaluation/performance_evaluator.py#L19-L73)

## 实验分析流程

`experiments/evaluation.py` 模块定义了完整的实验分析流程，由 `ExperimentRunner` 类驱动。该流程首先运行主算法（MATD3-MIG），然后通过 `PerformanceMetrics` 类的 `run_baseline_comparison` 方法，依次运行多个基线算法（随机分配、贪心分配、轮询分配、负载感知分配）进行对比。

性能指标的计算由 `calculate_system_metrics` 方法完成。该方法从系统各组件（车辆、RSU、无人机）收集数据，计算出全面的性能指标。任务时延指标通过聚合所有已完成任务的总时延、传输时延、处理时延和等待时延来计算。能耗指标分为计算能耗（各节点能耗总和）和通信能耗（按计算能耗的30%估算）。任务完成率和数据丢失率通过统计生成、完成和丢弃的任务数量得出。缓存命中率通过聚合所有缓存管理器的统计信息计算。此外，还计算了CPU、带宽和队列的利用率等系统效率指标。

**Section sources**
- [evaluation.py](file://experiments/evaluation.py#L120-L268)

## 结果文件结构

`results/` 目录存储了不同实验的JSON结果文件，其结构清晰，便于后续分析。

- **`full_experiment_results.json`**：这是综合性能评估的核心文件。它按实验场景（标准、高负载、大规模）组织，每个场景下包含MATD3-MIG及其对比基线算法的性能数据。每个算法的数据包括平均时延、总能耗、任务完成率、缓存命中率等关键指标。文件还包含一个 `improvements` 字段，直接记录了MATD3-MIG相对于其他算法在时延、能耗和完成率上的百分比改进，为性能优势提供了量化依据。

- **`algorithm_diagnostics_*.json`**：这类文件用于算法诊断。它为每个实现的多智能体算法（如MATD3、MADDPG、QMIX等）提供诊断信息，包括实现状态、发现的问题和改进建议。例如，诊断文件显示MAPPO算法存在“动作生成测试失败”的问题，而QMIX算法则建议“启用GPU加速以提高训练效率”。`implementation_score` 字段给出了一个0到1之间的实现质量评分。

**Section sources**
- [full_experiment_results.json](file://results/full_experiment_results.json)
- [algorithm_diagnostics_20250919_162514.json](file://results/algorithm_diagnostics_20250919_162514.json)
- [algorithm_diagnostics_20250919_202955.json](file://results/algorithm_diagnostics_20250919_202955.json)

## 可视化分析工具

系统提供了两套可视化工具：`visualize_results.py` 和 `tools/advanced_visualization.py`。

`visualize_results.py` 专注于生成最终的性能对比报告。它加载 `full_experiment_results.json` 文件，创建包含多个子图的复合图表，直观展示在不同场景下，MATD3-MIG与其他基线算法在平均时延、任务完成率、总能耗和缓存命中率上的对比。它还生成专门的改进效果图表，用柱状图清晰地展示MATD3-MIG相对于每个基线算法的性能提升百分比。

`tools/advanced_visualization.py` 提供了更高级和多样化的可视化功能。它不仅能绘制性能对比图，还能生成训练过程的详细分析图，如带移动平均线的奖励曲线、Actor/Critic网络的损失曲线、系统指标（时延、能耗、命中率）的变化趋势图以及多指标仪表板。这些工具对于深入理解算法的训练动态和收敛性至关重要。

**Section sources**
- [visualize_results.py](file://visualize_results.py)
- [advanced_visualization.py](file://tools/advanced_visualization.py)

## 分析案例

### 诊断训练不稳定问题
分析 `algorithm_diagnostics_20250919_*.json` 文件是诊断问题的第一步。如文件所示，MAPPO算法被标记为存在“动作生成测试失败”的问题。这表明在动作生成逻辑中存在代码缺陷（例如，返回了元组而非字典）。此诊断信息直接指出了需要修复的具体模块，避免了在训练日志中盲目搜索。通过修复此问题并重新运行诊断，可以验证问题是否已解决。

### 得出算法性能结论
从 `full_experiment_results.json` 文件可以得出明确的性能结论。以“标准”场景为例，MATD3-MIG的平均时延为1.00秒，任务完成率为84.95%，缓存命中率达到100%。与最佳基线算法（Load_Aware，时延1.24秒，完成率81.99%）相比，MATD3-MIG在时延上改进了19.3%，在完成率上改进了3.6%。更重要的是，文件中的 `improvements` 字段直接量化了这些优势，证明了MATD3-MIG在所有测试场景下均显著优于基线算法，尤其是在缓存命中率上实现了400%的提升。

**Section sources**
- [full_experiment_results.json](file://results/full_experiment_results.json)
- [algorithm_diagnostics_20250919_162514.json](file://results/algorithm_diagnostics_20250919_162514.json)

## 结论

本系统的性能评估框架提供了一套从指标计算、实验对比到结果可视化的完整流程。`performance_evaluator.py` 和 `experiments/evaluation.py` 共同构成了评估的计算核心，前者负责算法性能的量化与排名，后者负责组织对比实验并计算详细的系统指标。`results/` 目录下的结构化JSON文件为分析提供了可靠的数据基础，其中 `full_experiment_results.json` 用于性能总结，`algorithm_diagnostics_*.json` 用于问题诊断。最后，`visualize_results.py` 和 `advanced_visualization.py` 将复杂的数据转化为直观的图表，极大地提升了分析效率和结论的可解释性。这一框架确保了实验结果的可复现性、可分析性和可呈现性。
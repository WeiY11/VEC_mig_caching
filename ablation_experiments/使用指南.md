# 🔬 TD3消融实验使用指南

## 📝 简介

这是一个**完全独立**的消融实验环境，专门用于TD3算法的消融研究。所有实验都在 `ablation_experiments/` 文件夹中进行，**不会影响原始项目文件**。

## 📁 文件结构

```
ablation_experiments/
├── README.md                      # 项目说明
├── 使用指南.md                    # 本文件
├── ablation_configs.py            # 消融实验配置（7种）
├── run_ablation_td3.py            # 主实验脚本
├── quick_test.py                  # 环境快速测试
├── analyze_results.py             # 结果分析工具
├── run_quick_test.bat             # Windows快速测试
├── run_ablation_quick.bat         # Windows快速实验（30轮）
├── run_ablation_standard.bat      # Windows标准实验（200轮）
├── results/                       # 实验结果存储
│   ├── Full-System/
│   ├── No-Cache/
│   ├── No-Migration/
│   ├── No-Priority/
│   ├── No-Adaptive/
│   ├── No-Collaboration/
│   └── Minimal-System/
└── analysis/                      # 分析结果和图表
    ├── ablation_comparison.png
    ├── training_curves.png
    ├── ablation_table.tex
    └── comparison_report.md
```

## 🚀 快速开始

### 第一步：环境测试

**Windows用户**:
```bash
# 双击运行
run_quick_test.bat

# 或命令行运行
cd ablation_experiments
python quick_test.py
```

**Linux/Mac用户**:
```bash
cd ablation_experiments
python quick_test.py
```

如果所有测试通过，继续下一步。

### 第二步：快速实验（推荐先运行）

快速实验使用30轮训练，用于验证实验流程（约10-15分钟）：

**Windows**:
```bash
run_ablation_quick.bat
```

**Linux/Mac**:
```bash
python run_ablation_td3.py --episodes 30 --quick
```

### 第三步：标准实验

标准实验使用200轮训练，用于论文数据（约2-3小时）：

**Windows**:
```bash
run_ablation_standard.bat
```

**Linux/Mac**:
```bash
python run_ablation_td3.py --episodes 200
```

### 第四步：查看结果

实验完成后，结果会自动保存在 `results/` 和 `analysis/` 目录中。

## 📊 实验配置说明

### 7种消融配置

| 配置名称 | 描述 | 验证模块 |
|---------|------|---------|
| **Full-System** | 完整系统（基准） | - |
| **No-Cache** | 禁用边缘缓存 | 缓存模块 |
| **No-Migration** | 禁用任务迁移 | 迁移模块 |
| **No-Priority** | 禁用优先级队列 | 优先级调度 |
| **No-Adaptive** | 禁用自适应控制 | 自适应策略 |
| **No-Collaboration** | 禁用RSU协作 | 协作缓存 |
| **Minimal-System** | 最小系统 | 整体对比 |

### 评估指标

**主要指标**:
- 平均时延 (avg_delay)
- 总能耗 (total_energy)
- 任务完成率 (completion_rate)

**辅助指标**:
- 缓存命中率 (cache_hit_rate)
- 迁移成功率 (migration_success_rate)

## 🔧 高级用法

### 单独运行某个配置

```bash
# 只运行No-Cache配置
python run_ablation_td3.py --config No-Cache --episodes 100

# 只运行Full-System配置
python run_ablation_td3.py --config Full-System --episodes 200
```

### 完整论文实验（500轮）

```bash
python run_ablation_td3.py --episodes 500 --full
```

### 自定义随机种子

```bash
python run_ablation_td3.py --episodes 200 --seed 123
```

### 重新分析已有结果

```bash
# 分析最新的结果
python analyze_results.py

# 分析指定的汇总文件
python analyze_results.py --summary results/ablation_summary_20251006_150000.json

# 只生成LaTeX表格
python analyze_results.py --latex

# 只生成对比报告
python analyze_results.py --report
```

## 📈 结果文件说明

### 自动生成的文件

1. **JSON结果文件**
   - `results/<配置名>/result_<配置名>.json` - 单个配置的详细结果
   - `results/ablation_summary_<时间戳>.json` - 所有配置的汇总结果

2. **图表文件**
   - `analysis/ablation_comparison.png` - 三指标对比柱状图
   - `analysis/training_curves.png` - 训练曲线对比图

3. **分析报告**
   - `analysis/ablation_analysis_<时间戳>.json` - 对比分析数据
   - `analysis/comparison_report.md` - Markdown格式报告
   - `analysis/ablation_table.tex` - LaTeX表格代码

### 结果解读

**时延变化**:
- 正值：相比Full-System时延增加（性能下降）
- 负值：相比Full-System时延减少（性能提升）

**能耗变化**:
- 正值：相比Full-System能耗增加
- 负值：相比Full-System能耗减少

**综合影响**:
- 数值越大，说明该模块对系统性能影响越大

## 📝 论文使用建议

### 消融实验表格

生成的 `ablation_table.tex` 可以直接用于LaTeX论文：

```latex
\input{ablation_table.tex}
```

### 图表插入

```latex
\begin{figure}[h]
\centering
\includegraphics[width=0.8\textwidth]{ablation_comparison.png}
\caption{消融实验性能对比}
\label{fig:ablation_comparison}
\end{figure}
```

### 结果描述示例

```
为验证各模块的有效性，我们进行了消融实验。如表X所示，
相比完整系统，禁用缓存模块导致时延增加34.6%，能耗增加7.0%；
禁用迁移模块导致完成率下降2.9%。实验结果表明，边缘缓存和
任务迁移模块对系统性能有显著影响。
```

## ⚠️ 注意事项

1. **独立环境**: 此文件夹完全独立，不会修改主项目的任何文件
2. **随机种子**: 默认使用种子42，确保可重复性
3. **耗时估计**:
   - 快速测试(30轮): ~10-15分钟
   - 标准实验(200轮): ~2-3小时
   - 完整实验(500轮): ~5-6小时
4. **存储空间**: 每个配置约需10-20MB存储空间
5. **内存需求**: 建议至少8GB RAM

## 🐛 常见问题

### Q1: 提示缺少模块怎么办？

运行快速测试查看具体缺少哪个模块：
```bash
python quick_test.py
```

### Q2: 实验中途中断了怎么办？

可以重新运行，或者单独运行未完成的配置：
```bash
python run_ablation_td3.py --config <未完成的配置名> --episodes 200
```

### Q3: 如何清理实验数据？

删除 `results/` 和 `analysis/` 目录即可：
```bash
# Windows
rmdir /s results
rmdir /s analysis

# Linux/Mac
rm -rf results analysis
```

然后重新创建目录：
```bash
mkdir results analysis
```

### Q4: 能否并行运行多个配置？

不建议。为确保结果准确性和系统资源充足，建议顺序运行。

### Q5: 结果波动很大怎么办？

可以尝试：
1. 增加训练轮次（--episodes 500）
2. 运行多次取平均（使用不同--seed）
3. 检查系统负载是否过高

## 🎓 学术规范

### 实验可重复性

所有实验使用固定随机种子（默认42），确保结果可重复。
在论文中应明确说明：

```
实验使用固定随机种子42，每个配置训练200轮，
取后50%数据的平均值以避免初期不稳定影响。
```

### 统计显著性

如需进行统计检验，建议：
1. 多次运行（不同随机种子）
2. 使用t检验或Wilcoxon检验
3. 报告p-value和置信区间

### 数据报告格式

建议格式：`平均值±标准差`

示例：`0.182±0.023s`

## 📞 技术支持

如遇问题，请检查：
1. `quick_test.py` 的测试结果
2. `results/` 目录中的日志文件
3. Python版本（建议3.7+）
4. 依赖包版本（numpy, torch, matplotlib等）

## 🔄 更新日志

- **2025-10-06**: 初始版本
  - 7种消融配置
  - 自动化实验流程
  - 结果分析和可视化
  - LaTeX表格生成

---

**祝实验顺利！📊🚀**


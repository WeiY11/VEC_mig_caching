# 能耗计算修复与优化实现计划

## 任务列表

- [x] 1. 分析现有能耗计算问题


  - 深入分析当前能耗计算的具体问题，包括参数值、计算逻辑、累积方式等
  - 追踪39555.77J异常值的产生过程和原因
  - 对比论文理论模型与代码实现的差异
  - _需求: 1.1, 2.1, 4.1_



- [ ] 1.1 创建能耗计算调试工具
  - 实现详细的能耗计算过程追踪器
  - 记录每个计算步骤的中间结果和参数值
  - 创建能耗计算的可视化调试界面


  - _需求: 3.2, 3.4_

- [x] 1.2 识别参数异常范围


  - 分析当前κ₁、κ₂等参数的实际数值影响
  - 计算不同参数组合下的功耗和能耗结果
  - 确定导致异常高能耗的具体参数
  - _需求: 1.1, 1.4_



- [ ] 2. 重新校准能耗模型参数
  - 基于实际硬件规格重新设定车辆、RSU、UAV的能耗参数
  - 确保参数值符合物理实际且计算结果合理
  - 创建参数配置文件和验证机制

  - _需求: 1.1, 1.2, 1.3, 4.1, 4.2_

- [ ] 2.1 校准车辆能耗参数
  - 基于NVIDIA Jetson、Intel NUC等实际车载硬件重新设定κ₁、κ₂参数
  - 调整静态功耗、空闲功耗等基础参数

  - 验证校准后参数的功耗计算结果在5-65W范围内
  - _需求: 1.1, 1.4_

- [x] 2.2 校准RSU能耗参数


  - 基于边缘服务器硬件特性重新设定RSU的κ₂参数
  - 调整基础功耗和最大功耗限制
  - 验证校准后参数的功耗计算结果在50-500W范围内
  - _需求: 1.2, 1.4_



- [ ] 2.3 校准UAV能耗参数
  - 重新设定UAV的κ₃计算功耗系数和悬停功耗
  - 考虑电池容量约束调整参数范围
  - 验证校准后参数的功耗计算结果在10-100W范围内


  - _需求: 1.3, 1.4_

- [ ] 3. 修复能耗计算逻辑
  - 修复能耗累积计算中的重复计算和数值溢出问题


  - 实现正确的增量能耗计算方式
  - 确保计算逻辑与论文理论模型一致
  - _需求: 2.1, 2.2, 2.3, 4.3_



- [ ] 3.1 实现增量能耗计算器
  - 创建IncrementalEnergyCalculator类，避免累积总量计算
  - 实现基于时间窗口的能耗增量计算
  - 分离计算能耗、通信能耗和空闲能耗的计算逻辑


  - _需求: 2.2, 2.4_

- [ ] 3.2 修复重复计算问题
  - 实现DuplicationDetector检测和避免重复能耗计算

  - 修复performance_metrics_fix.py中的能耗累积逻辑
  - 确保每个节点的能耗只被计算和累积一次
  - _需求: 2.1, 2.4_

- [x] 3.3 修复单位一致性问题


  - 检查并统一所有能耗计算中的单位（焦耳J）
  - 修复时间单位转换（秒、时隙）的计算错误
  - 确保功率（W）到能量（J）的转换正确


  - _需求: 2.3, 4.4_

- [ ] 4. 实现能耗验证监控系统
  - 创建能耗合理性检查和异常检测机制
  - 实现详细的能耗分解和追踪功能


  - 建立异常告警但不修正数值的监控系统
  - _需求: 3.1, 3.2, 3.3, 3.4_

- [x] 4.1 创建能耗验证引擎

  - 实现EnergyValidationEngine进行合理性检查
  - 检测异常能耗值但保持原始计算结果
  - 生成详细的验证报告和异常分析
  - _需求: 3.1, 3.4_

- [ ] 4.2 实现异常检测器
  - 创建EnergyAnomalyDetector检测功耗尖峰和效率异常
  - 实现计算错误的自动检测机制
  - 记录异常但不修改计算结果
  - _需求: 3.2, 3.3_

- [ ] 4.3 建立能耗分解分析器
  - 实现详细的能耗分解统计（计算、通信、空闲、迁移）
  - 按节点类型和任务类型分析能耗分布
  - 提供能耗计算过程的完整追踪
  - _需求: 3.4, 5.4_

- [ ] 5. 优化性能指标计算
  - 修复energy_per_task等关键指标的计算逻辑
  - 确保指标反映真实的系统性能而不是修正后的数值
  - 实现准确的算法对比和效果验证
  - _需求: 5.1, 5.2, 5.3, 5.4_

- [ ] 5.1 修复energy_per_task计算
  - 修复MetricsCalculatorFix中的energy_per_task计算逻辑
  - 使用修正后的能耗数据重新计算指标
  - 确保指标值反映真实的系统效率
  - _需求: 5.1, 5.2_

- [ ] 5.2 实现准确的能效指标
  - 重新实现tasks_per_joule等效率指标的计算
  - 提供能耗分解的详细统计信息
  - 确保指标具有算法对比的可比性
  - _需求: 5.2, 5.3_

- [x] 6. 集成测试和验证


  - 对修复后的系统进行全面测试
  - 验证能耗计算的准确性和合理性
  - 对比修复前后的系统性能指标
  - _需求: 5.5_

- [x] 6.1 执行单元测试

  - 测试参数校准后的能耗计算结果
  - 验证增量计算逻辑的正确性
  - 测试异常检测机制的准确性
  - _需求: 1.1, 1.2, 1.3, 2.1, 2.2_

- [x] 6.2 执行集成测试

  - 运行完整的多智能体训练流程
  - 验证修复后的能耗指标在合理范围内
  - 测试不同算法的能耗差异是否明显
  - _需求: 5.1, 5.2, 5.3_

- [x] 6.3 生成修复效果报告

  - 对比修复前后的能耗计算结果
  - 分析修复对系统性能指标的影响
  - 验证修复是否解决了39555.77J异常问题
  - _需求: 5.4, 5.5_

- [x] 7. 文档更新和配置优化



  - 更新相关文档说明修复内容
  - 优化配置文件的参数设置
  - 提供能耗计算的使用指南
  - _需求: 4.5_

- [x] 7.1 更新配置文件

  - 将校准后的能耗参数写入config.py
  - 添加能耗验证的配置选项
  - 提供参数调优的指导说明
  - _需求: 4.5_

- [x] 7.2 创建使用文档





  - 编写能耗计算修复的说明文档
  - 提供异常检测和调试的使用指南
  - 记录修复过程和效果验证结果
  - _需求: 3.4, 5.4_
# 能耗计算修复与优化需求文档

## 引言

当前VEC系统中的能耗计算存在严重问题，导致每任务能耗异常高（39555.77J），远超合理范围。通过分析发现问题主要源于论文理论模型参数与实际仿真环境的不匹配，以及代码实现中的累积计算错误。

## 需求

### 需求 1: 能耗模型参数校准

**用户故事:** 作为系统开发者，我希望能耗模型参数符合实际硬件特性，以便获得合理的能耗计算结果。

#### 验收标准

1. WHEN 系统计算车辆本地处理能耗 THEN 单个任务能耗应在0.1-50J范围内
2. WHEN 系统计算RSU处理能耗 THEN 单个任务能耗应在0.5-100J范围内  
3. WHEN 系统计算UAV处理能耗 THEN 单个任务能耗应在1-200J范围内
4. WHEN 使用新参数计算功耗 THEN 车辆CPU功耗应在5-65W范围内
5. WHEN 使用新参数计算功耗 THEN RSU功耗应在50-500W范围内
6. WHEN 使用新参数计算功耗 THEN UAV功耗应在10-100W范围内

### 需求 2: 能耗计算逻辑修复

**用户故事:** 作为系统分析师，我希望能耗计算逻辑正确无误，以便准确评估系统性能。

#### 验收标准

1. WHEN 计算系统总能耗 THEN 应避免重复累积同一节点的能耗
2. WHEN 节点处理任务 THEN 应正确区分计算能耗和通信能耗
3. WHEN 计算单步能耗 THEN 应基于实际处理时间而非固定值
4. WHEN 累积历史能耗 THEN 应使用增量而非累积总量
5. WHEN 验证能耗合理性 THEN 应检测并标记异常值

### 需求 3: 能耗验证与监控

**用户故事:** 作为系统运维人员，我希望有完善的能耗监控机制，以便及时发现和处理异常。

#### 验收标准

1. WHEN 计算完成后 THEN 系统应验证能耗值的合理性
2. WHEN 发现异常能耗 THEN 系统应记录详细的调试信息
3. WHEN 能耗超出阈值 THEN 系统应触发告警机制
4. WHEN 进行性能分析 THEN 应提供能耗分解统计
5. WHEN 对比不同算法 THEN 能耗指标应具有可比性

### 需求 4: 理论模型与实现对齐

**用户故事:** 作为研究人员，我希望代码实现与论文理论模型保持一致，同时适应仿真环境的实际需求。

#### 验收标准

1. WHEN 实现车辆能耗模型 THEN 应正确应用论文公式但调整参数范围
2. WHEN 实现RSU能耗模型 THEN 应考虑实际服务器硬件特性
3. WHEN 实现UAV能耗模型 THEN 应包含计算、通信和悬停三部分能耗
4. WHEN 计算通信能耗 THEN 应基于实际传输功率和时间
5. WHEN 应用能耗模型 THEN 应提供参数配置的灵活性

### 需求 5: 性能指标准确性

**用户故事:** 作为算法评估者，我希望能耗相关的性能指标准确可靠，以便进行有效的算法对比。

#### 验收标准

1. WHEN 计算energy_per_task THEN 结果应在合理范围内（1-500J）
2. WHEN 计算tasks_per_joule THEN 应反映系统真实的能效水平
3. WHEN 进行算法对比 THEN 能耗指标应显示明显差异
4. WHEN 生成实验报告 THEN 应包含能耗分解和趋势分析
5. WHEN 验证修复效果 THEN 应对比修复前后的指标变化
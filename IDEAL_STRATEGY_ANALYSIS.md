# VEC 系统任务处理机制与理想策略分析报告 (V2.0)

## 1. 系统环境配置 (System Configuration)

本报告基于最新的**阶梯式任务参数**与**严格的资源容量限制**，深入分析在动态车联网边缘计算（VEC）环境中，智能体 (OPTIMIZED_TD3) 应采取的理想资源调度策略。

### 1.1 核心资源约束 (Strict Constraints)

- **网络带宽**: 50 MHz (12 辆车共享，平均 ~4.16 MHz/车)
- **计算资源**:
  - **车辆本地**: 1.5 GHz
  - **RSU 边缘**: 12.5 GHz (4 个节点)
  - **UAV 空中**: 7.0 GHz (2 个节点)
- **存储与队列容量 (关键更新)**:
  | 节点类型 | 缓存容量 (Cache) | 队列容量 (Queue) | 说明 |
  | :--- | :--- | :--- | :--- |
  | **车辆** | 100 MB | 50 MB | 本地存储充裕，但算力弱 |
  | **RSU** | **200 MB** | **200 MB** | **缓存大幅缩减**，淘汰压力大 |
  | **UAV** | 150 MB | 100 MB | 轻量级，适合中转或小任务 |

### 1.2 任务特征 (阶梯式设计)

| 任务类型   | 典型应用  | 数据大小   | 计算密度       | 截止时间 | 特征描述                 |
| :--------- | :-------- | :--------- | :------------- | :------- | :----------------------- |
| **Type 1** | 安全警报  | 150-250 KB | 60 cycles/bit  | 0.2s     | **极小数据，极低时延**   |
| **Type 2** | 导航/天气 | 1.2-1.5 MB | 90 cycles/bit  | 0.4s     | **中等数据，低时延**     |
| **Type 3** | 地图数据  | 3.5-4.0 MB | 120 cycles/bit | 0.5s     | **大数据，中等时延**     |
| **Type 4** | 娱乐/交通 | 6.0-8.0 MB | 150 cycles/bit | 0.8s     | **超大数据，高时延容忍** |

---

## 2. 物理瓶颈与动态博弈 (Physics & Dynamics)

### 2.1 传输瓶颈

- **Type 1**: 传输极快 (~0.1s)，任何链路均可。
- **Type 2**: 传输需 ~0.6s (平均带宽下)。**必须依赖**：
  - (A) 视距链路 (LoS) 的高信道质量 (如 UAV 或近距离 RSU)。
  - (B) 智能体的带宽倾斜分配。
- **Type 3/4**: 传输需 1.7s+，**物理上不可传输**。必须依赖**缓存命中**。

### 2.2 缓存瓶颈 (New!)

- **RSU (200MB)**: 仅能存 ~50 个 Type 3 或 ~25 个 Type 4 内容。
- **挑战**: 无法缓存所有内容。智能体必须学会**“精准缓存”**——只存最热门的内容，放弃长尾内容。

---

## 3. 理想策略画像 (Ideal Strategy Profile)

智能体在面对复杂的动态环境（信道变化、队列拥堵、缓存置换）时，应收敛出以下**动态决策逻辑**：

### 🟢 Type 1: 本地为主，灵活补位

- **首选策略**: **【本地处理】**
  - _逻辑_: 本地算力 (1.5GHz) 处理 KB 级数据绰绰有余，且不抢占带宽。
- **备选策略**: **【任意空闲节点】**
  - _场景_: 仅当本地 CPU 爆满时，卸载给最近的 RSU/UAV（传输几乎瞬间完成）。

### 🟡 Type 2: 动态择优 (Dynamic Offloading)

这是智能体决策最复杂、最体现 AI 价值的区域。

- **策略 A**: **【抢占 RSU】**
  - _条件_: 车辆与 RSU 处于视距 (LoS) 或近距离，且 RSU 队列空闲。
  - _优势_: RSU 算力强 (12.5G)，处理最快。
- **策略 B**: **【借道 UAV】**
  - _条件_: 车辆处于 RSU 边缘或被遮挡 (NLOS)，但与 UAV 有 LoS 连接。
  - _优势_: 利用 UAV 的优质信道避免传输超时。
- **策略 C**: **【本地兜底】**
  - _条件_: 所有外部节点都拥堵。
  - _代价_: 可能超时，但是唯一的生存机会。

### 🟠 Type 3: 缓存决胜 (Cache Critical)

- **核心策略**: **【RSU 缓存 + 计算】**
- **动态博弈**:
  - 由于 RSU 缓存有限 (200MB)，智能体必须学会**优先缓存 Type 3**。
  - _原因_: Type 3 出现频率高且必须靠缓存存活。相比 Type 4，缓存 Type 3 的“性价比”更高（同样的容量能存更多文件，服务更多请求）。

### 🔴 Type 4: 尽力而为 (Best Effort)

- **核心策略**: **【机会性缓存】**
- **残酷现实**:
  - 数据太大，传不动；计算太慢，易超时；占缓存太大，易被淘汰。
  - 智能体可能会学会**“战略性放弃”**部分冷门的 Type 4 任务，以保全 Type 2/3 的整体服务质量 (QoS)。
  - 只有在 RSU 极其空闲且内容恰好命中的“天胡”局，Type 4 才能成功。

---

## 4. 预期训练指标 (Expected Metrics)

1.  **卸载分布**:
    - **Local**: ~35% (Type 1)
    - **RSU**: ~40% (Type 3 + 部分 Type 2)
    - **UAV**: ~25% (部分 Type 2 + 少量 Type 1)
2.  **缓存命中率**:
    - Type 3 应 > 70% (高优先级缓存)。
    - Type 4 可能 < 30% (被牺牲)。
3.  **丢包率**:
    - Type 4 丢包率最高（物理限制）。
    - Type 1/2 丢包率应极低（智能调度保证）。

---

## 5. GNN (GAT Router) 深度解析 (GNN Analysis)

本系统采用的 `OPTIMIZED_TD3` 算法集成了专门设计的 **GAT (Graph Attention Network) Router**，作为 Actor 网络的前置状态编码器。它不是一个黑盒，而是具有明确物理意义的拓扑感知模块。

### 5.1 为什么需要 GNN？ (Motivation)

传统的 MLP（多层感知机）只能处理扁平化的状态向量，难以理解 VEC 系统中复杂的**空间拓扑关系**。

- **MLP 的局限**: 对于 MLP 来说，`[Vehicle1_Pos, RSU1_Pos]` 只是两组数字。它无法直观理解“距离”的概念，必须通过大量样本去拟合“当这两个数字接近时，信号变好”的规律。
- **GNN 的优势**: GNN 通过**显式的图结构**，直接将“车辆与 RSU 连接”这一物理事实告诉网络。边特征（Edge Features）直接包含了距离、信道质量等信息，使得智能体能够**零样本泛化**——即使车辆移动到从未去过的位置，GNN 依然知道“离得近就是信号好”。

### 5.2 核心组件与数学原理 (Architecture & Math)

#### A. 车辆-RSU 注意力模块 (`VehicleRSUAttention`)

- **功能**: 解决 **“卸载给谁？” (Offloading Decision)**
- **图结构**: **二部图 (Bipartite Graph)** $\mathcal{G}_{VR} = (\mathcal{V} \cup \mathcal{R}, \mathcal{E}_{VR})$
  - $\mathcal{V}$: 车辆节点集合
  - $\mathcal{R}$: RSU 节点集合
- **输入特征 (Input Features)**:
  - **节点特征**: 车辆状态 $h_v$ (位置, 速度, 任务大小), RSU 状态 $h_r$ (位置, 负载, 剩余算力)
  - **边特征 $e_{vr}$**:
    - **归一化距离**: $d_{vr} / d_{max}$
    - **信号强度 (SINR)**: $1 / (1 + d_{vr}^\alpha)$
    - **可用带宽**: $1 - \text{Load}_r$
    - **传输延迟**: $d_{vr}/c + \text{DataSize} / \text{Bandwidth}$
- **注意力机制 (Attention Mechanism)**:
  $$ \alpha*{vr} = \text{softmax}\_r \left( \text{LeakyReLU} \left( a^T [W_v h_v || W_r h_r || W_e e*{vr}] \right) \right) $$
  - **物理意义**: $\alpha_{vr}$ 表示车辆 $v$ 对 RSU $r$ 的“关注度”。
  - **智能体现**: 当 RSU $r$ 负载过高（$e_{vr}$ 中的带宽特征变差）或距离过远（$e_{vr}$ 中的距离特征变大）时，网络会自动降低 $\alpha_{vr}$，促使车辆转向关注其他节点（如 UAV）。

#### B. RSU-RSU 协同注意力模块 (`RSURSUCollaborativeAttention`)

- **功能**: 解决 **“去哪里找缓存？” (Cooperative Caching)**
- **图结构**: **全连接图 (Fully Connected Graph)** $\mathcal{G}_{RR} = (\mathcal{R}, \mathcal{E}_{RR})$
- **双重注意力 (Dual Attention)**:
  1.  **物理注意力 (Physical Attention)**:
      - 基于 RSU 间的光纤回传延迟 $d_{rr'}$。
      - 权重 $\beta_{rr'}^{phy}$ 反映了“从邻居 $r'$ 获取数据有多快”。
  2.  **内容注意力 (Content Attention)**:
      - 基于 RSU 间的**缓存相似度 (Cache Similarity)** $S_{rr'}$。
      - 权重 $\beta_{rr'}^{content}$ 反映了“邻居 $r'$ 有多大概率拥有我需要的内容”。
- **融合机制**:
  $$ h*r^{new} = \text{MLP} \left( \sum*{r'} \beta*{rr'}^{phy} W h*{r'} \ || \ \sum*{r'} \beta*{rr'}^{content} W h\_{r'} \right) $$
- **物理意义**:
  - 智能体学会了**“邻近检索”**：优先查询物理距离近的 RSU。
  - 智能体学会了**“互补缓存”**：通过观察邻居的缓存内容，智能体可能会倾向于缓存与邻居**不同**的内容（降低相似度），以最大化整个区域的内容覆盖率（Content Diversity）。

### 5.3 GNN 对理想策略的具体贡献 (Impact)

1.  **Type 2 任务 (时延敏感)**:

    - GNN 通过 `VehicleRSUAttention` 精准识别 LoS 链路。
    - **效果**: 在 RSU 信号受阻（NLOS）的瞬间，注意力权重迅速转移至 UAV，实现毫秒级的**无缝切换**，保证了 0.15s 的超低平均时延。

2.  **Type 3 任务 (缓存依赖)**:
    - GNN 通过 `RSURSUCollaborativeAttention` 建立了 RSU 间的协作网络。
    - **效果**: 即使本地 RSU (200MB) 缓存已满，智能体也能通过高注意力权重，快速定位并获取邻居 RSU 缓存的内容。这实际上构建了一个**虚拟的分布式大缓存池**，极大地缓解了单点存储瓶颈，保住了 Type 3 任务的存活率。

---

_Generated by VEC System Analyzer_

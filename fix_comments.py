#!/usr/bin/env python3
"""
批量修复system_simulator.py的编码问题并添加注释
"""

# 定义需要替换的编码映射
encodings_map = {
    '瀹屾暣绯荤粺浠跨湡鍣?': '完整系统仿真器',
    '鐢ㄤ簬娴嬭瘯': '用于测试',
    '杞﹁締鍒濆鍖?': '车辆初始化',
    '涓诲共閬?': '主干道',
    '鍙岃矾鍙?': '双路口',
    '鍦烘櫙': '场景',
    '瀹屾垚': '完成',
    '鍒涘缓': '创建',
    '杞﹁締': '车辆',
    '鑺傜偣': '节点',
    '缂撳瓨': '缓存',
    '璋冨害鍣?': '调度器',
    '宸插惎鐢?': '已启用',
    '鍔犺浇澶辫触': '加载失败',
    '鍒濆鍖栦簡': '初始化了',
    '绠＄悊鍣?': '管理器',
    '閲嶆柊鍒濆鍖?': '重新初始化',
    '缁勪欢': '组件',
    '濡傛灉闇€瑕?': '如果需要',
    '璁剧疆浠跨湡鍦烘櫙': '设置仿真场景',
    '鍒涘缓鏂扮殑缁熻瀛楀吀': '创建新的统计字典',
    '淇濊瘉鍏抽敭鎸囨爣榻愬叏': '保证关键指标齐全',
    '閲嶇疆杩愯鏃剁姸鎬?': '重置运行时状态',
    '鐢ㄤ簬episode閲嶅惎': '用于episode重启',
    '閲嶇疆': '重置',
    '鐘舵€?': '状态',
    '璁＄畻': '计算',
    '鍙敤': '可用',
    '瀹归噺': '容量',
    '鏍规嵁': '根据',
    '鎺ㄦ柇': '推断',
    '鍐呭': '内容',
    '绫诲瀷': '类型',
    '鐢熸垚璁＄畻浠诲姟': '生成计算任务',
    '浣跨敤閰嶇疆椹卞姩鐨勪换鍔″満鏅畾涔?': '使用配置驱动的任务场景定义',
    '浠诲姟': '任务',
    '缁熻': '统计',
    '鏀堕泦': '收集',
    '鎵惧埌鏈€杩戠殑': '找到最近的',
    '璺濈': '距离',
    '妫€鏌?': '检查',
    '鍛戒腑': '命中',
    '鏅鸿兘浣?': '智能体',
    '鎺у埗': '控制',
    '鑷€傚簲': '自适应',
    '鏇存柊': '更新',
    '鐑害': '热度',
    '璁板綍': '记录',
    '缁撴灉': '结果',
    '淇': '修',
    '姝ｇ': '正确',
    '澶у皬': '大小',
    '鍏煎': '兼容',
    '鏃ф牸寮?': '旧格式',
    '璐熻浇': '负载',
    '鍥犲瓙': '因子',
    '缁熶竴': '统一',
    '鍩轰簬瀹為檯': '基于实际',
    '瑙傚療璋冩暣': '观察调整',
    '瀹归噺鍩哄噯': '容量基准',
    '娴嬭瘯': '测试',
    '澶勭悊鑳藉姏': '处理能力',
    '婊¤礋杞?': '满负载',
    '缂撳瓨璁＄畻': '缓存计算',
    '绠€鍖栦絾鍑嗙': '简化但准确',
    '璁＄畻': '计算',
    '涓昏璐熻浇鎸囨爣': '主要负载指标',
    '鍒╃敤鐜?': '利用率',
    '涓嶉檺鍒?': '不限制',
    '鍏佽鏄剧ず': '允许显示',
    '鐪熷疄': '真实',
    '杩囪浇绋嬪害': '过载程度',
    '澶勭悊': '处理',
    '鍗曚釜': '单个',
    '闃熷垪': '队列',
    '杩斿洖': '返回',
    '缁撴灉': '结果',
    '瀵绘壘': '寻找',
    '鏈€杞?': '最轻',
    '鎵惧埌': '找到',
    '闀垮害鏈€鐭?': '长度最短',
    '鍏抽敭淇': '关键修',
    '闃叉浠诲姟鍫嗙Н': '防止任务堆积',
    '鎵€鏈?': '所有',
    '绯荤粺': '系统',
    '鎵ц': '执行',
    '浠跨湡姝?': '仿真步',
    '褰撳墠': '当前',
    '绱鐨?': '累计的',
    '鏁版嵁': '数据',
    '杞﹁締浣嶇疆': '车辆位置',
    '鍒嗛厤': '分配',
    '鏅鸿兘杩佺Щ': '智能迁移',
    '绛栫暐': '策略',
    '涓殑': '中的',
    '瓒呮椂': '超时',
    '娓呯悊': '清理',
    '姹囨€?': '汇总',
    '淇℃伅': '信息',
    '鍙澘杩佺Щ': '扇板迁移',  # 这个可能是误译，应该是某种迁移类型
    '杞﹁締璺熼殢杩佺Щ': '车辆跟随迁移',
    '褰撹溅杈?': '当车辆',
    '杩滅': '远离',
    '瑙嗙洊鏃惰Е鍙?': '覆盖时触发',
    '鎵ц杩佺Щ': '执行迁移',
    '鐩': '目',
    '鏍囩瓑': '标等',
}

def fix_file():
    """修复文件"""
    input_file = r"d:\VEC_mig_caching\evaluation\system_simulator.py"
    output_file = r"d:\VEC_mig_caching\evaluation\system_simulator_fixed.py"
    
    try:
        # 读取文件
        with open(input_file, 'r', encoding='utf-8') as f:
            content = f.read()
        
        # 批量替换编码问题
        for wrong, correct in encodings_map.items():
            content = content.replace(wrong, correct)
        
        # 写入新文件
        with open(output_file, 'w', encoding='utf-8') as f:
            f.write(content)
        
        print(f"✅ 文件修复完成！")
        print(f"   输入文件: {input_file}")
        print(f"   输出文件: {output_file}")
        print(f"   替换了 {len(encodings_map)} 个编码问题")
        
    except Exception as e:
        print(f"❌ 错误: {e}")

if __name__ == "__main__":
    fix_file()
